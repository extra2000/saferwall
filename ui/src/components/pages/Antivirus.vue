<template>
  <div class="tile is-ancestor">
    <div class="tile is-parent is-6">
      <div class="tile is-child box">
        <h4 class="title">First Scan</h4>
        <table class="table is-striped is-fullwidth">
          <thead>
            <tr>
              <th>Antivirus</th>
              <th>Output</th>
              <th>Update</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(value, vendor) in Scans.firstScan" :key="vendor">
              <td>{{ _.upperFirst(vendor) }}</td>
              <td>
                <span
                  :class="[
                    { 'has-text-success': !value.infected },
                    { 'has-text-danger': value.infected },
                  ]"
                  style="position:relative"
                  @mouseover="mouseOver('first', vendor)"
                  @mouseleave="mouseLeave('first', vendor)"
                >
                  <span
                    :class="{
                      transparent:
                        value.infected &&
                        JSON.stringify(show) ===
                          JSON.stringify({ type: 'first', vendor: vendor }),
                    }"
                  >
                    <i
                      class="output-icon icon"
                      :class="[
                        { 'ion-alert-circled': value.infected },
                        { 'ion-checkmark-circled': !value.infected },
                      ]"
                    ></i>
                    {{ value.output || "Clean" }}
                  </span>
                  <transition name="fade">
                    <copy
                      v-if="
                        value.infected &&
                          JSON.stringify(show) ===
                            JSON.stringify({ type: 'first', vendor: vendor })
                      "
                      :content="value.output"
                    ></copy>
                  </transition>
                </span>
              </td>
              <td>
                {{ value.update }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="tile is-parent is-6">
      <div class="tile is-child box">
        <h4 class="title">Last Scan</h4>
        <table class="table is-striped is-fullwidth">
          <thead>
            <tr>
              <th>Antivirus</th>
              <th>Output</th>
              <th>Update</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(value, vendor) in Scans.lastScan" :key="vendor">
              <td>{{ _.upperFirst(vendor) }}</td>
              <td>
                <span
                  :class="[
                    { 'has-text-success': !value.infected },
                    { 'has-text-danger': value.infected },
                  ]"
                  style="position:relative"
                  @mouseover="mouseOver('last', vendor)"
                  @mouseleave="mouseLeave('last', vendor)"
                >
                  <span
                    :class="{
                      transparent:
                        value.infected &&
                        JSON.stringify(show) ===
                          JSON.stringify({ type: 'last', vendor: vendor }),
                    }"
                  >
                    <i
                      class="output-icon icon"
                      :class="[
                        { 'ion-alert-circled': value.infected },
                        { 'ion-checkmark-circled': !value.infected },
                      ]"
                    ></i>
                    {{ value.output || "Clean" }}
                  </span>
                  <transition name="fade">
                    <copy
                      v-if="
                        value.infected &&
                          JSON.stringify(show) ===
                            JSON.stringify({ type: 'last', vendor: vendor })
                      "
                      :content="value.output"
                    ></copy>
                  </transition>
                </span>
              </td>
              <td>
                {{ value.update }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<script>
import Copy from "@/components/elements/Copy"
import { mapGetters } from "vuex"

export default {
  components: {
    copy: Copy,
  },
  data() {
    return {
      show: { type: "", vendor: "" },
    }
  },
  computed: {
    ...mapGetters({ fileData: "getFileData" }),
    Scans: function() {
      if (Object.entries(this.fileData).length === 0) return {}

      var _firstScan = this.fileData.multiav.first_scan
      var _lastScan = this.fileData.multiav.last_scan

      Object.keys(_firstScan).forEach((key) => {
        _firstScan[key].showCopy = false
        _lastScan[key].showCopy = false

        if (!_firstScan[key]['enabled']) {
          delete _firstScan[key]
        }
        if (!_lastScan[key]['enabled']) {
          delete _lastScan[key]
        }
      })

      return {
        firstScan: _firstScan,
        lastScan: _lastScan,
      }
    },
  },
  methods: {
    mouseOver(type, vendor) {
      this.show = { type, vendor }
    },
    mouseLeave(type, index) {
      this.show = {}
    },
  },
}
</script>

<style lang="scss" scoped>
.fade-enter-active,
.fade-leave-active {
  transition-property: opacity;
  transition-duration: 0.25s;
}

.fade-enter-active {
  transition-delay: 0;
}

.fade-enter,
.fade-leave-active {
  opacity: 0;
}
span {
  transition: all 0.2s;
}
.transparent {
  opacity: 0.35;
}
.output-icon {
  font-size: 18px;
  display: inline-block;
}
</style>
